<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Data Table</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 1rem 2rem;
      background: #111827;
      color: #f9fafb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header h1 {
      margin: 0;
      font-size: 1.4rem;
    }

    header .subtitle {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .content {
      flex: 1;
      display: flex;
      gap: 1.5rem;
      padding: 1.5rem 2rem 2rem;
    }

    /* MAIN TABLE AREA */
    .main-panel {
      flex: 3;
      min-width: 0;
      display: flex;
      flex-direction: column;
      align-items: center; /* center table horizontally in this area */
      gap: 0.75rem;
    }

    #status {
      font-size: 0.85rem;
      color: #4b5563;
      width: 100%;
      max-width: 900px;
    }

    /* Fixed-size centered table window */
    .table-wrapper {
      background: #ffffff;
      border-radius: 0.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      padding: 0.5rem;

      width: 900px;   /* set desired width */
      height: 600px;  /* set desired height */
      max-width: 100%; /* responsive on smaller screens */

      overflow: auto; /* scroll inside the window */
      margin: 0 auto;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      min-width: max-content; /* keep columns visible, allow horizontal scroll */
    }

    th, td {
      padding: 0.5rem 0.7rem;
      border: 1px solid #e5e7eb;
      text-align: left;
      font-size: 0.9rem;
      white-space: nowrap;
    }

    thead tr:nth-child(1) th {
      background: #f9fafb;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 2;
    }

    thead tr:nth-child(2) th {
      background: #f3f4f6;
      position: sticky;
      top: 32px; /* approximate height of first header row */
      z-index: 1;
    }

    tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    /* Filter inputs row */
    .filter-input {
      width: 100%;
      padding: 0.25rem 0.35rem;
      border-radius: 0.25rem;
      border: 1px solid #d1d5db;
      font-size: 0.8rem;
    }

    .filter-input:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37,99,235,0.2);
    }

    /* SIDE PANEL WITH EXTRA CONTENT */
    .side-panel {
      flex: 1;
      min-width: 220px;
      max-width: 320px;
      background: #111827;
      color: #f9fafb;
      border-radius: 0.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      padding: 1rem 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .side-panel h2 {
      margin: 0 0 0.5rem;
      font-size: 1.05rem;
    }

    .side-panel p {
      margin: 0;
      font-size: 0.85rem;
      line-height: 1.4;
      color: #d1d5db;
    }

    .side-panel hr {
      border: none;
      border-top: 1px solid #374151;
      margin: 0.5rem 0;
    }

    .side-panel a {
      color: #60a5fa;
      text-decoration: none;
      font-size: 0.85rem;
    }

    .side-panel a:hover {
      text-decoration: underline;
    }

    footer {
      padding: 0.5rem 2rem 0.8rem;
      font-size: 0.75rem;
      color: #6b7280;
      background: #f3f4f6;
    }

    @media (max-width: 900px) {
      .content {
        flex-direction: column;
      }
      .side-panel {
        max-width: 100%;
        order: -1;
      }
      .table-wrapper {
        width: 100%;
        height: 400px; /* smaller fixed height on small screens */
      }
      #status {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div>
        <h1>My Data Table</h1>
        <div class="subtitle">Live from Google Sheets, with filters & fixed-size scrolling window</div>
      </div>
    </header>

    <div class="content">
      <!-- MAIN TABLE AREA -->
      <section class="main-panel">
        <div id="status">Loading data…</div>
        <div class="table-wrapper">
          <table id="data-table">
            <!-- Populated by JS -->
          </table>
        </div>
      </section>

      <!-- SIDE PANEL WITH EXTRA CONTENT -->
      <aside class="side-panel">
        <h2>Notes / Info Panel</h2>
        <p>
          This side panel is for any extra content you want next to the table:
          explanations, instructions, links, or other widgets.
        </p>
        <hr />
        <p>
          Edit this panel directly in <code>index.html</code>. You can add:
        </p>
        <ul style="padding-left: 1.1rem; margin: 0; font-size: 0.85rem;">
          <li>Explanations for each column</li>
          <li>Rules or methodology</li>
          <li>Links to external docs or tools</li>
        </ul>
        <hr />
        <p>
          Example external link:<br />
          <a href="https://docs.google.com" target="_blank" rel="noopener noreferrer">
            Open the source Google Sheet
          </a>
        </p>
      </aside>
    </div>

    <footer>
      Data is loaded from a published Google Sheet CSV. Update the sheet → table updates on refresh.
    </footer>
  </div>

  <script>
    const SHEET_CSV_URL = "YOUR_SHEET_CSV_URL_HERE"; // <-- replace this

    let originalData = []; // full 2D array from CSV (including header row)
    let filters = [];      // current filter values per column

    async function fetchCsv(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error("Failed to fetch CSV: " + res.status);
      return await res.text();
    }

    function parseCsv(text) {
      // Simple CSV parser, handles basic quoted cells
      const lines = text.trim().split(/\r?\n/);
      return lines.map(line => {
        const result = [];
        let current = "";
        let inQuotes = false;

        for (let i = 0; i < line.length; i++) {
          const char = line[i];

          if (char === '"') {
            if (inQuotes && i + 1 < line.length && line[i + 1] === '"') {
              // Escaped quote
              current += '"';
              i++;
            } else {
              inQuotes = !inQuotes;
            }
          } else if (char === "," && !inQuotes) {
            result.push(current);
            current = "";
          } else {
            current += char;
          }
        }
        result.push(current);
        return result;
      });
    }

    function buildTableSkeleton(headers) {
      const table = document.getElementById("data-table");
      table.innerHTML = "";

      const thead = document.createElement("thead");
      const headerRow = document.createElement("tr");
      const filterRow = document.createElement("tr");

      headers.forEach((h, colIndex) => {
        // Header cell
        const th = document.createElement("th");
        th.textContent = h;
        headerRow.appendChild(th);

        // Filter cell
        const filterTh = document.createElement("th");
        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = "Filter…";
        input.className = "filter-input";
        input.dataset.colIndex = colIndex;

        input.addEventListener("input", () => {
          filters[colIndex] = input.value.toLowerCase();
          renderBody();
        });

        filterTh.appendChild(input);
        filterRow.appendChild(filterTh);
      });

      thead.appendChild(headerRow);
      thead.appendChild(filterRow);
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      table.appendChild(tbody);
    }

    function renderBody() {
      if (!originalData.length) return;

      const headers = originalData[0];
      const rows = originalData.slice(1);
      const table = document.getElementById("data-table");
      const tbody = table.querySelector("tbody");
      tbody.innerHTML = "";

      const activeFilters = filters.map(f => (f || "").trim());

      rows.forEach(row => {
        const matches = row.every((cell, colIndex) => {
          const filterValue = activeFilters[colIndex];
          if (!filterValue) return true;
          const cellText = (cell || "").toString().toLowerCase();
          return cellText.includes(filterValue);
        });

        if (!matches) return;

        const tr = document.createElement("tr");
        headers.forEach((_, colIndex) => {
          const td = document.createElement("td");
          td.textContent = row[colIndex] ?? "";
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    async function init() {
      const statusEl = document.getElementById("status");

      try {
        statusEl.textContent = "Loading data from Google Sheets…";

        const cacheBust = (SHEET_CSV_URL.includes("?") ? "&" : "?") + "cachebust=" + Date.now();
        const csvText = await fetchCsv(SHEET_CSV_URL + cacheBust);
        const data = parseCsv(csvText);

        if (!data.length) {
          statusEl.textContent = "No data found in sheet.";
          return;
        }

        originalData = data;
        filters = new Array(data[0].length).fill("");

        const headers = data[0];
        buildTableSkeleton(headers);
        renderBody();

        statusEl.textContent = "Loaded " + (data.length - 1) + " rows. Use the filters below the headers.";
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Error loading data. Check the console for details.";
      }
    }

    init();
  </script>
</body>
</html>
