<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Data Table</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 1rem 2rem;
      background: #111827;
      color: #f9fafb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header h1 {
      margin: 0;
      font-size: 1.4rem;
    }

    header .subtitle {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .content {
      flex: 1;
      display: flex;
      gap: 1.5rem;
      padding: 1.5rem 2rem 2rem;
    }

    /* MAIN TABLE AREA */
    .main-panel {
      flex: 3;
      min-width: 0;
      display: flex;
      flex-direction: column;
      align-items: center; /* center table horizontally */
      gap: 0.75rem;
    }

    #status {
      font-size: 0.85rem;
      color: #4b5563;
      width: 100%;
      max-width: 900px;
    }

    /* Fixed-size centered table window */
    .table-wrapper {
      background: #ffffff;
      border-radius: 0.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      padding: 0.5rem;

      width: 900px;   /* adjust width as desired */
      height: 600px;  /* adjust height as desired */
      max-width: 100%;

      overflow: auto; /* scrolling */
      margin: 0 auto;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      min-width: max-content;
    }

    th, td {
      padding: 0.5rem 0.7rem;
      border: 1px solid #e5e7eb;
      text-align: left;
      font-size: 0.9rem;
      white-space: nowrap;
    }

    thead tr:nth-child(1) th {
      background: #f9fafb;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 2;
    }

    thead tr:nth-child(2) th {
      background: #f3f4f6;
      position: sticky;
      top: 32px; /* approximate height of first header row */
      z-index: 1;
    }

    tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    .filter-input {
      width: 100%;
      padding: 0.25rem 0.35rem;
      border-radius: 0.25rem;
      border: 1px solid #d1d5db;
      font-size: 0.8rem;
    }

    .filter-input:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37,99,235,0.2);
    }

    /* SIDE PANEL */
    .side-panel {
      flex: 1;
      min-width: 220px;
      max-width: 320px;
      background: #111827;
      color: #f9fafb;
      border-radius: 0.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      padding: 1rem 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .side-panel h2 {
      margin: 0 0 0.5rem;
      font-size: 1.05rem;
    }

    .side-panel p {
      margin: 0;
      font-size: 0.85rem;
      line-height: 1.4;
      color: #d1d5db;
    }

    .side-panel hr {
      border: none;
      border-top: 1px solid #374151;
      margin: 0.5rem 0;
    }

    footer {
      padding: 0.5rem 2rem 0.8rem;
      font-size: 0.75rem;
      color: #6b7280;
      background: #f3f4f6;
    }

    @media (max-width: 900px) {
      .content {
        flex-direction: column;
      }
      .side-panel {
        max-width: 100%;
        order: -1;
      }
      .table-wrapper {
        width: 100%;
        height: 400px;
      }
      #status {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div>
        <h1>My Data Table</h1>
        <div class="subtitle">
          Pokémon set pricing — filter by Set name only
        </div>
      </div>
    </header>

    <div class="content">
      <!-- MAIN TABLE AREA -->
      <section class="main-panel">
        <div id="status">Loading data…</div>
        <div class="table-wrapper">
          <table id="data-table"></table>
        </div>
      </section>

      <!-- SIDE PANEL -->
      <aside class="side-panel">
        <h2>Notes / Info Panel</h2>
        <p>
          First column = <strong>Set</strong> (Pokémon set name) — this is filterable.
        </p>
        <p>
          All other columns are <strong>Rip N Ship content creators</strong> and show pricing data. They are display-only and do not have filters.
        </p>
        <hr />
        <p>
          You can customize this panel with any info you want: explanations,
          methodology, update schedule, etc.
        </p>
      </aside>
    </div>

    <footer>
      Data is loaded live from a Google Sheets CSV. Update the sheet → site updates on refresh.
    </footer>
  </div>

  <script>
    const SHEET_CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vR7JmVmiBVMg8BemKADybQiK4GFol_btZQwZHBF0_UW7gWaVfr0g0dKaktZhXldurUBMojyVu56wzHP/pub?output=csv";

    let originalData = [];
    let filters = [];

    async function fetchCsv(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error("Failed to fetch CSV: " + res.status);
      return await res.text();
    }

    function parseCsv(text) {
      const lines = text.trim().split(/\r?\n/);
      return lines.map(line => {
        const result = [];
        let current = "";
        let inQuotes = false;

        for (let i = 0; i < line.length; i++) {
          const char = line[i];

          if (char === '"') {
            if (inQuotes && i + 1 < line.length && line[i + 1] === '"') {
              current += '"';
              i++;
            } else {
              inQuotes = !inQuotes;
            }
          } else if (char === "," && !inQuotes) {
            result.push(current);
            current = "";
          } else {
            current += char;
          }
        }
        result.push(current);
        return result;
      });
    }

    function buildTableSkeleton(headers) {
      const table = document.getElementById("data-table");
      table.innerHTML = "";

      const thead = document.createElement("thead");
      const headerRow = document.createElement("tr");
      const filterRow = document.createElement("tr");

      headers.forEach((h, colIndex) => {
        // Header cell (all columns)
        const th = document.createElement("th");
        th.textContent = h;
        headerRow.appendChild(th);

        // Filter row:
        // Only the first column ("Set") gets a filter input.
        const filterTh = document.createElement("th");

        if (colIndex === 0) {
          const input = document.createElement("input");
          input.type = "text";
          input.placeholder = "Filter Set…";
          input.className = "filter-input";
          input.dataset.colIndex = colIndex;

          input.addEventListener("input", () => {
            filters[colIndex] = input.value.toLowerCase();
            renderBody();
          });

          filterTh.appendChild(input);
        }
        // For all other columns (content creators / pricing), filterTh stays empty.
        filterRow.appendChild(filterTh);
      });

      thead.appendChild(headerRow);
      thead.appendChild(filterRow);
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      table.appendChild(tbody);
    }

    function renderBody() {
      if (!originalData.length) return;

      const headers = originalData[0];
      const rows = originalData.slice(1);
      const table = document.getElementById("data-table");
      const tbody = table.querySelector("tbody");
      tbody.innerHTML = "";

      const activeFilters = filters.map(f => (f || "").trim());

      rows.forEach(row => {
        // Only filter by column 0 (Set)
        const setFilter = activeFilters[0];
        if (setFilter) {
          const cellText = (row[0] || "").toString().toLowerCase();
          if (!cellText.includes(setFilter)) {
            return; // row doesn't match filter
          }
        }

        const tr = document.createElement("tr");
        headers.forEach((_, colIndex) => {
          const td = document.createElement("td");
          td.textContent = row[colIndex] ?? "";
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    async function init() {
      const statusEl = document.getElementById("status");

      try {
        statusEl.textContent = "Loading data from Google Sheets…";

        const cacheBust =
          (SHEET_CSV_URL.includes("?") ? "&" : "?") + "cachebust=" + Date.now();

        const csvText = await fetchCsv(SHEET_CSV_URL + cacheBust);
        const data = parseCsv(csvText);

        if (!data.length) {
          statusEl.textContent = "No data found in sheet.";
          return;
        }

        originalData = data;
        filters = new Array(data[0].length).fill("");

        const headers = data[0];
        buildTableSkeleton(headers);
        renderBody();

        statusEl.textContent =
          "Loaded " + (data.length - 1) + " rows. Filter by Set using the box under the first column.";
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Error loading data. Check console.";
      }
    }

    init();
  </script>
</body>
</html>
